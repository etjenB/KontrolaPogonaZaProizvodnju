<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Pogon za proizvodnju ƒçokolade</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" media="screen" href="ProizvodnjaCokolade.css" />
    <script src="ProizvodnjaCokolade.js"></script>
</head>

<!--Moras dodat prvo ucitavanje senzora u body onload=prvoUcitavanjeSenzora() tako nesto-->
<body onload="ucitavanje()">
<div class="silosi">
    <div id="silosMedId">

    </div>
    <div id="silosZitariceId">

    </div>
    <div id="silosTopljenaCokoladaId">

    </div>
    <div id="silosBademiId">

    </div>
</div>
<div id="traka1">
    <div id="traka11" class="traka1">

    </div>
    <div id="traka12" class="traka1">

    </div>
    <div id="traka13" class="traka1">

    </div>
    <div id="traka14" class="traka1">

    </div>
</div>
<div id="Mjesalica">
    <div id="handId">

    </div>
</div>
<div id="silosBaznaSmjesaId">

</div>
<div id="traka2">
    <div id="traka21" class="traka2">

    </div>
    <div id="traka22" class="traka2">

    </div>
    <div id="traka23" class="traka2">

    </div>
    <div id="traka24" class="traka2">

    </div>
    <div id="traka25" class="traka2">

    </div>
    <div id="traka26" class="traka2">

    </div>
    <div id="traka27" class="traka2">

    </div>
</div>
<div id="traka3">
    <div id="traka31" class="traka3">

    </div>
    <div id="traka32" class="traka3">

    </div>
    <div id="traka33" class="traka3">

    </div>
    <div id="traka34" class="traka3">

    </div>
    <div id="traka35" class="traka3">

    </div>
</div>
<div id="AparatZaMljevenje">

</div>
<div id="Pakovanje">
    <a style="font-family: 'Dubai Medium'">PAKOVANJE</a>
</div>
<div class="kontrole">
    <button onclick="komandaTraka('KomandaTraka');">Pokreni/zaustavi traku</button>
    <button onclick="napuniSilose('Silosi')">Napuni silose</button>
    <button onclick="komandaMijesanjeTraka('MijesanjeTraka')">Pokreni mijesanje meda i zitarica</button>
    <input style="width: 50px" id="medKol">
    <input style="width: 50px" id="topCok">
    <input style="width: 50px" id="bazSmj">
</div>
<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.7.0/firebase.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.7.0/firebase-analytics.js"></script>
<script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
        apiKey: "AIzaSyB3cCD-N4xfNR4u_pfB3tbEFxWYEnDqcr0",
        authDomain: "proizvodnjacokolade-7ef48.firebaseapp.com",
        databaseURL: "https://proizvodnjacokolade-7ef48-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "proizvodnjacokolade-7ef48",
        storageBucket: "proizvodnjacokolade-7ef48.appspot.com",
        messagingSenderId: "1038652963846",
        appId: "1:1038652963846:web:65a64ed0ed6548c6ce5787",
        measurementId: "G-3YWVGJ93VP"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    firebase.analytics();

    let medKol = document.getElementById("medKol");
    let topCok = document.getElementById("topCok");
    let bazSmj = document.getElementById("bazSmj");

    var isTrakaPokrenuta;
    var isMijesanjeTraka;
    var bademiKolicina;
    var baznaSmjesaKolicina;
    var medKolicina;
    var topljenaCokoladaKolicina;
    var usitnjeniBademiKolicina;
    var zitariceKolicina;

    var refTrakaPokrenuta = firebase.database().ref().child("KomandaTraka/TrakaPokrenuta");
    var refMijesanjeTraka = firebase.database().ref().child("MijesanjeTraka/TrakaPokrenuta");
    var refBademi = firebase.database().ref().child("Silosi/Bademi");
    //var refBaznaSmjesa = firebase.database().ref().child("Silosi/BaznaSmjesa");
    var refBaznaSmjesa = firebase.database().ref().child("BaznaSmjesa");
    var refMed = firebase.database().ref().child("Silosi/Med");
    var refTopljenaCokolada = firebase.database().ref().child("Silosi/TopljenaCokolada");
    var refUsitnjeniBademi = firebase.database().ref().child("Silosi/UsitnjeniBademi");
    var refZitarice = firebase.database().ref().child("Silosi/Zitarice");

    refMed.on('value', (snapshot) => {
        medKol.value = snapshot.val();
    });
    refTopljenaCokolada.on('value', (snapshot) => {
        topCok.value = snapshot.val();
    });
    refBaznaSmjesa.on('value', (snapshot) => {
        bazSmj.value = snapshot.val();
    });


    napuniSilose=(lokacija)=>{
        if (isTrakaPokrenuta==false && isMijesanjeTraka==false){
            if (bademiKolicina+medKolicina+topljenaCokoladaKolicina+zitariceKolicina < 400) {
                DoAnimationSilosi();
                for (let i = 0; i < 5; i++) {
                    setTimeout(function() {
                        switch (i) {
                            case 0: firebase.database().ref(lokacija).set({
                                Bademi: 20,
                                Med: 20,
                                TopljenaCokolada: 20,
                                Zitarice: 20

                            }); break;
                            case 1: firebase.database().ref(lokacija).set({
                                Bademi: 40,
                                Med: 40,
                                TopljenaCokolada: 40,
                                Zitarice: 40

                            }); break;
                            case 2: firebase.database().ref(lokacija).set({
                                Bademi: 60,
                                Med: 60,
                                TopljenaCokolada: 60,
                                Zitarice: 60

                            }); break;
                            case 3: firebase.database().ref(lokacija).set({
                                Bademi: 80,
                                Med: 80,
                                TopljenaCokolada: 80,
                                Zitarice: 80

                            }); break;
                            case 4: firebase.database().ref(lokacija).set({
                                Bademi: 100,
                                Med: 100,
                                TopljenaCokolada: 100,
                                Zitarice: 100
                            }); alert("Silosi su napunjeni."); break;
                        }
                    }, 2000*i );
                }
            }else{
                alert("Silosi su puni!");
            }
        }else{
            alert("Nije moguce puniti silose dok je proizvodna traka u pokretu!");
        }
    }

    function DoAnimationSilosi() {
        var targetElement1 = document.getElementById("silosMedId");
        targetElement1.className = "silosMed";
        var targetElement2 = document.getElementById("silosZitariceId");
        targetElement2.className = "silosZitarice";
        var targetElement3 = document.getElementById("silosTopljenaCokoladaId");
        targetElement3.className = "silosTopljenaCokolada";
        var targetElement4 = document.getElementById("silosBademiId");
        targetElement4.className = "silosBademi";
    }

    komandaTraka=(lokacija)=>{
        if (isTrakaPokrenuta==true){
            firebase.database().ref(lokacija).set({
                TrakaPokrenuta: false
            }, (error) => {
                if (error) {
                    console.log("Greska u snimanju podataka!");
                } else {
                    console.log("Uspjesno snimljeni podaci!");
                }
            });
            alert("Traka je zaustavljena!");
            document.getElementById("traka21").style.border = "red 5px solid";
            document.getElementById("traka22").style.border = "red 5px solid";
            document.getElementById("traka23").style.border = "red 5px solid";
            document.getElementById("traka24").style.border = "red 5px solid";
            document.getElementById("traka25").style.border = "red 5px solid";
            document.getElementById("traka26").style.border = "red 5px solid";
            document.getElementById("traka27").style.border = "red 5px solid";
            document.getElementById("Pakovanje").style.border = "red 5px solid";
            document.getElementById("Pakovanje").style.backgroundColor = "indianred";
        }else if(topCok.value>0 && bazSmj.value>0 && isTrakaPokrenuta==false){
            firebase.database().ref(lokacija).set({
                TrakaPokrenuta: true

            }, (error) => {
                if (error) {
                    console.log("Greska u snimanju podataka!");
                } else {
                    console.log("Uspjesno snimljeni podaci!");
                }
            });
            alert("Traka je pokrenuta!");
            document.getElementById("traka21").style.border = "green 5px solid";
            document.getElementById("traka22").style.border = "green 5px solid";
            document.getElementById("traka23").style.border = "green 5px solid";
            document.getElementById("traka24").style.border = "green 5px solid";
            document.getElementById("traka25").style.border = "green 5px solid";
            document.getElementById("traka26").style.border = "green 5px solid";
            document.getElementById("traka27").style.border = "green 5px solid";
            document.getElementById("Pakovanje").style.border = "green 5px solid";
            document.getElementById("Pakovanje").style.backgroundColor = "lightgreen";
        }
    }

    komandaMijesanjeTraka=(lokacija)=>{
        if (isMijesanjeTraka==true){
            firebase.database().ref(lokacija).set({
                TrakaPokrenuta: false
            }, (error) => {
                if (error) {
                    console.log("Greska u snimanju podataka!");
                } else {
                    console.log("Uspjesno snimljeni podaci!");
                }
            });
            alert("Mijesanje je zaustavljeno!");
            DoAnimationMijesanje();
            document.getElementById("traka11").style.border = "red 5px solid";
            document.getElementById("traka12").style.border = "red 5px solid";
            document.getElementById("traka13").style.border = "red 5px solid";
            document.getElementById("traka14").style.border = "red 5px solid";
        }else{
            firebase.database().ref(lokacija).set({
                TrakaPokrenuta: true

            }, (error) => {
                if (error) {
                    console.log("Greska u snimanju podataka!");
                } else {
                    console.log("Uspjesno snimljeni podaci!");
                }
            });
            alert("Mijesanje je pokrenuto!");
            DoAnimationMijesanje();
            document.getElementById("traka11").style.border = "green 5px solid";
            document.getElementById("traka12").style.border = "green 5px solid";
            document.getElementById("traka13").style.border = "green 5px solid";
            document.getElementById("traka14").style.border = "green 5px solid";
        }
    }

    function DoAnimationMijesanje(){
        var targetElement1 = document.getElementById("handId");
        var targetElement2 = document.getElementById("silosBaznaSmjesaId");
        var targetElement3 = document.getElementById("silosMedId");
        var targetElement4 = document.getElementById("silosZitariceId");
        if (targetElement1.className=="hand"){
            targetElement1.className = "";
        }else {
            targetElement1.className = "hand";
            targetElement2.className = "silosBaznaSmjesa";
            targetElement3.className = "silosMedUse";
            targetElement4.className = "silosZitariceUse";
            firebase.database().ref("Silosi").set({
                Bademi: 0,
                Med: 0,
                TopljenaCokolada: topljenaCokoladaKolicina,
                Zitarice: zitariceKolicina

            });
        }
    }



    function ucitavanje(){
        refTrakaPokrenuta.on('value', (snapshot) => {
            isTrakaPokrenuta = snapshot.val();
            if (isTrakaPokrenuta == true) {
                document.getElementById("traka21").style.border = "green 5px solid";
                document.getElementById("traka22").style.border = "green 5px solid";
                document.getElementById("traka23").style.border = "green 5px solid";
                document.getElementById("traka24").style.border = "green 5px solid";
                document.getElementById("traka25").style.border = "green 5px solid";
                document.getElementById("traka26").style.border = "green 5px solid";
                document.getElementById("traka27").style.border = "green 5px solid";
                document.getElementById("Pakovanje").style.border = "green 5px solid";
                document.getElementById("Pakovanje").style.backgroundColor = "lightgreen";
            }else{
                document.getElementById("traka21").style.border = "red 5px solid";
                document.getElementById("traka22").style.border = "red 5px solid";
                document.getElementById("traka23").style.border = "red 5px solid";
                document.getElementById("traka24").style.border = "red 5px solid";
                document.getElementById("traka25").style.border = "red 5px solid";
                document.getElementById("traka26").style.border = "red 5px solid";
                document.getElementById("traka27").style.border = "red 5px solid";
                document.getElementById("Pakovanje").style.border = "red 5px solid";
                document.getElementById("Pakovanje").style.backgroundColor = "indianred";
            }
        }, (errorObject) => {
            console.log('The read failed: ' + errorObject.name);
        });

        refMijesanjeTraka.on('value', (snapshot) => {
            isMijesanjeTraka = snapshot.val();
            if (isMijesanjeTraka == true) {
                document.getElementById("traka11").style.border = "green 5px solid";
                document.getElementById("traka12").style.border = "green 5px solid";
                document.getElementById("traka13").style.border = "green 5px solid";
                document.getElementById("traka14").style.border = "green 5px solid";
            }else{
                document.getElementById("traka11").style.border = "red 5px solid";
                document.getElementById("traka12").style.border = "red 5px solid";
                document.getElementById("traka13").style.border = "red 5px solid";
                document.getElementById("traka14").style.border = "red 5px solid";
            }
        }, (errorObject) => {
            console.log('The read failed: ' + errorObject.name);
        });

        refBademi.on('value', (snapshot) => {
            bademiKolicina = snapshot.val();
        });
        refBaznaSmjesa.on('value', (snapshot) => {
            baznaSmjesaKolicina = snapshot.val();
        });
        refMed.on('value', (snapshot) => {
            medKolicina = snapshot.val();
        });
        refTopljenaCokolada.on('value', (snapshot) => {
            topljenaCokoladaKolicina = snapshot.val();
            if (topljenaCokoladaKolicina >= 100){
                DoAnimationSilosi();
            }
        });
        refUsitnjeniBademi.on('value', (snapshot) => {
            usitnjeniBademiKolicina = snapshot.val();
        });
        refZitarice.on('value', (snapshot) => {
            zitariceKolicina = snapshot.val();
        });
    }
</script>


</body>
</html>